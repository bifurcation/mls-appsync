<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>An Application Interface to Messaging Layer Security</title>
<meta content="Joel Alwen" name="author">
<meta content="Richard Barnes" name="author">
<meta content="Rohan Mahy" name="author">
<meta content="Marta Mularczyk" name="author">
<meta content="
       The Messaging Layer Security protocol enables a group of participants to
negotiate a common cryptographic state.  While the primary function of MLS is to
establish shared secret state for the group, an MLS group also captures
authentication information for group participants and information on which the
group has confirmed agreement.  This document defines an interface interface by
which multiple uncoordinated application functions may safely reuse the
cryptographic state of an MLS group for application purposes. 
    " name="description">
<meta content="xml2rfc 3.24.0" name="generator">
<meta content="messaging layer security" name="keyword">
<meta content="end-to-end encryption" name="keyword">
<meta content="draft-barnes-mls-appsync-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.24.0
    Python 3.12.7
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-barnes-mls-appsync.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">MLS App API</td>
<td class="right">December 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Alwen, et al.</td>
<td class="center">Expires 6 June 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Messaging Layer Security</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-barnes-mls-appsync-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-12-03" class="published">3 December 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-06-06">6 June 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Alwen</div>
<div class="org">Amazon</div>
</div>
<div class="author">
      <div class="author-name">R. Barnes</div>
<div class="org">Cisco</div>
</div>
<div class="author">
      <div class="author-name">R. Mahy</div>
<div class="org">Rohan Mahy Consulting Services</div>
</div>
<div class="author">
      <div class="author-name">M. Mularczyk</div>
<div class="org">Amazon</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">An Application Interface to Messaging Layer Security</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Messaging Layer Security protocol enables a group of participants to
negotiate a common cryptographic state.  While the primary function of MLS is to
establish shared secret state for the group, an MLS group also captures
authentication information for group participants and information on which the
group has confirmed agreement.  This document defines an interface interface by
which multiple uncoordinated application functions may safely reuse the
cryptographic state of an MLS group for application purposes.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://bifurcation.github.io/mls-appsync/draft-barnes-mls-appsync.html">https://bifurcation.github.io/mls-appsync/draft-barnes-mls-appsync.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-barnes-mls-appsync/">https://datatracker.ietf.org/doc/draft-barnes-mls-appsync/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Messaging Layer Security Working Group mailing list (<span><a href="mailto:mls@ietf.org">mailto:mls@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/mls/">https://mailarchive.ietf.org/arch/browse/mls/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/mls/">https://www.ietf.org/mailman/listinfo/mls/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/bifurcation/mls-appsync">https://github.com/bifurcation/mls-appsync</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 June 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-application-component-inter" class="internal xref">Application Component Interface</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-component-ids" class="internal xref">Component IDs</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-hybrid-public-key-encryptio" class="internal xref">Hybrid Public Key Encryption (HPKE) Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-signature-keys" class="internal xref">Signature Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-pre-shared-keys" class="internal xref">Pre-Shared Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-exported-secrets" class="internal xref">Exported Secrets</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-carrying-application-data-i" class="internal xref">Carrying Application Data in MLS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.1">
                    <p id="section-toc.1-1.4.2.6.2.1.1"><a href="#section-4.6.1" class="auto internal xref">4.6.1</a>.  <a href="#name-application_data-extension" class="internal xref"><code>application_data</code> Extension</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.2">
                    <p id="section-toc.1-1.4.2.6.2.2.1"><a href="#section-4.6.2" class="auto internal xref">4.6.2</a>.  <a href="#name-applicationdata" class="internal xref">ApplicationData</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6.2.3">
                    <p id="section-toc.1-1.4.2.6.2.3.1"><a href="#section-4.6.3" class="auto internal xref">4.6.3</a>.  <a href="#name-applicationdataupdate" class="internal xref">ApplicationDataUpdate</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Messaging Layer Security protocol (MLS) is designed to be integrated into
applications, in order to provide security services that the application
requires <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>.  There are two questions to answer when designing such an
integration:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-2">
<li id="section-1-2.1">
          <p id="section-1-2.1.1">How does the application provide the services that MLS requires?<a href="#section-1-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-2.2">
          <p id="section-1-2.2.1">How does the application use MLS to get security benefits?<a href="#section-1-2.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-1-3">The MLS Architecture describes the requirements for the first of these questions
<span>[<a href="#I-D.mls-architecture" class="cite xref">I-D.mls-architecture</a>]</span>, namely the structure of the Delivery Service and
Authentication Service that MLS requires.  This document is focused on the
second question.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">MLS itself offers some basic functions that applications can use, such as the
secure message encapsulation (PrivateMessage), the MLS exporter, and the epoch
authenticator.  Current MLS applications make use of these mechanisms to acheive
a variety of confidentiality and authentication properties.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">As application designers become more familiar with MLS, there is increasing
interest in leveraging otehr cryptographic tools that an MLS group provides:<a href="#section-1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-6.1">
          <p id="section-1-6.1.1">HPKE and signature key pairs for each member, where the private key is known
only to that member, and the public key is authenticated to the other members.<a href="#section-1-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-6.2">
          <p id="section-1-6.2.1">A pre-shared key mechanism that can allow an application to inject data into
the MLS key schedule.<a href="#section-1-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-6.3">
          <p id="section-1-6.3.1">An exporter mechanism that allows applications to derive secrets from the MLS
key schedule.<a href="#section-1-6.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-7">There is also interest in exposing an MLS group to multiple loosely-coordinated
components of an application.  To support these use cases, there is a need for a
mechanism that provides application components access to MLS's cryptographic
tools in a way that ensure that different components' usage will not conflict
with each other, or with MLS itself.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">This document defines a set of mechanisms that application components can use to
ensure that their use of these facilities is properly domain-separated from MLS
itself, and from other application components that might be using the same MLS
group.<a href="#section-1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">We make heavy use of the terminology in the MLS specification <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-3">
        <dt id="section-2-3.1">Application:</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.2">
          <p id="section-2-3.2.1">The system that instantiates, manages, and uses an MLS group.  Each MLS group
is used by exactly one application, but an application may maintain multiple
groups.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.3">Application component:</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.4">
          <p id="section-2-3.4.1">A subsystem of an application that has access to an MLS group.<a href="#section-2-3.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-3.5">Component ID:</dt>
        <dd style="margin-left: 1.5em" id="section-2-3.6">
          <p id="section-2-3.6.1">An identifier for an application component.  These identifiers are assigned by
the application.<a href="#section-2-3.6.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="protocol-overview">
<section id="section-3">
      <h2 id="name-protocol-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3-1.1">
          <p id="section-3-1.1.1">TODO: Examples of how an application would use these things<a href="#section-3-1.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="application-component-interface">
<section id="section-4">
      <h2 id="name-application-component-inter">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-application-component-inter" class="section-name selfRef">Application Component Interface</a>
      </h2>
<p id="section-4-1">The mechansms in this document take MLS mechanisms that are either not
inherently designed to be used by applications, or not inherently designed to be
used by multiple application components, and adds a domain separator that
separates application usage from MLS usage, and application components' usage
from each other:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">Signing operations are tagged so that signatures will only verify in the
context of a given component.<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">Public-key encryption operations are similarly tagged so that encrypted data
will only decrypt in the context of a given component.<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.3">
          <p id="section-4-2.3.1">Pre-shared keys are identified as originating from a specific component, so
that differnet components' contributions to the MLS key schedule will not
collide.<a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.4">
          <p id="section-4-2.4.1">Exported values include an identifier for the component to which they are
being exported, so that different components will get different exported
values.<a href="#section-4-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-3">We also define two new general mechanisms that allow applications to take
advantage of the extensibility mechanisms of MLS:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">An <code>application_data</code> extension type that associates application data with MLS
messages, or with the state of the group.<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.2">
          <p id="section-4-4.2.1">An ApplicationData proposal type that enables arbitrary application data to
be associated to a Commit.<a href="#section-4-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-4.3">
          <p id="section-4-4.3.1">An ApplicationDataUpdate proposal type that enables efficient updates to
an <code>application_data</code> GroupContext extension.<a href="#section-4-4.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-5">As with the above, information carried in these proposals and extension marked
as belonging to a specific application component, so that components can manage
their information independently.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">The separation between components is acheived by the application assigning each
component a unique component ID number.  These numbers are then incorporated
into the appopriate calculations in the protocol to achieve the required
separation.<a href="#section-4-6" class="pilcrow">¶</a></p>
<div id="component-ids">
<section id="section-4.1">
        <h3 id="name-component-ids">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-component-ids" class="section-name selfRef">Component IDs</a>
        </h3>
<p id="section-4.1-1">A component ID is a four-byte value that uniquely identifies a component within
the scope of an application.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2"><code>
uint32 ComponentID;
</code><a href="#section-4.1-2" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.1-3.1">
            <p id="section-4.1-3.1.1">TODO: What are the uniqueness requirements on these?  It seems like the more
diversity, the better.  For example, if a ComponentID is reused across
applications (e.g., via an IANA registry), then there will be a risk of replay
across applications.  Maybe we should include a binder to the group/epoch as
well, something derived from the key schedule.<a href="#section-4.1-3.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.1-4.1">
            <p id="section-4.1-4.1.1">TODO: It might be better to frame these in terms of "data types" instead of
components, to avoid presuming software architecture.  Though that makes less
sense for the more "active" portions of the API, e.g., signing and encryption.<a href="#section-4.1-4.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-5">When a label is required for an operation, the following data structure is used.
The <code>label</code> field identifies the operation being performed.  The <code>component_id</code>
field identifies the component performing the operation.  The <code>context</code> field is
specified by the operation in question.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.1-6">
<pre>
struct {
  opaque label&lt;V&gt;;
  ComponentID component_id;
  opaque context&lt;V&gt;;
} ComponentOperationLabel;
</pre><a href="#section-4.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hybrid-public-key-encryption-hpke-keys">
<section id="section-4.2">
        <h3 id="name-hybrid-public-key-encryptio">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-hybrid-public-key-encryptio" class="section-name selfRef">Hybrid Public Key Encryption (HPKE) Keys</a>
        </h3>
<p id="section-4.2-1">This component of the API allows components to make use of the HPKE key pairs
generated by MLS. An component identified by an CompnentID can use any HPKE
key pair for any operation defined in <span>[<a href="#RFC9180" class="cite xref">RFC9180</a>]</span>, such as encryption,
exporting keys and the PSK mode, as long as the <code>info</code> input to <code>Setup&lt;MODE&gt;S</code>
and <code>Setup&lt;MODE&gt;R</code> is set to ComponentOperationLabel with <code>component_id</code> set
to the appopriate ComponentID. The <code>context</code> can be set to an arbitrary Context
specified by the application designer and can be empty if not needed. For
example, a component can use a key pair PublicKey, PrivateKey to encrypt data
as follows:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2-2">
<pre>
SafeEncryptWithContext(ComponentID, PublicKey, Context, Plaintext) =
    SealBase(PublicKey, ComponentOperationLabel, "", Plaintext)

SafeDecryptWithContext(ComponentID, PrivateKey, Context, KEMOutput, Ciphertext) =
    OpenBase(KEMOutput, PrivateKey, ComponentOperationLabel, "", Ciphertext)
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">Where the fields of ComponentOperationLabel are set to<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.2-4">
<pre>
label = "MLS 1.0 Application"
component_id = ComponentID
context = Context
</pre><a href="#section-4.2-4" class="pilcrow">¶</a>
</div>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.2-5.1">
            <p id="section-4.2-5.1.1">TODO: Should this use EncryptWithLabel / DecryptWithLabel?  That wouldn't
cover other modes / exports, but you could say "mutatis mutandis".<a href="#section-4.2-5.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.2-6">For operations involving the secret key, ComponentID <span class="bcp14">MUST</span> be set to the
ComponentID of the component performing the operation, and not to the ID of
any other component. In particular, this means that a component cannot decrypt
data meant for another component, while components can encrypt data that other
components can decrypt.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">In general, a ciphertext encrypted with a PublicKey can be decrypted by any
entity who has the corresponding PrivateKey at a given point in time according
to the MLS protocol (or application component). For convenience, the following
list summarizes lifetimes of MLS key pairs.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-8.1">
            <p id="section-4.2-8.1.1">The key pair of a non-blank ratchet tree node. The PrivateKey of such a key pair
is known to all members in the node’s subtree. In particular, a PrivateKey of a
leaf node is known only to the member in that leaf. A member in the subtree
stores the PrivateKey for a number of epochs, as long as the PublicKey does not
change. The key pair of the root node <span class="bcp14">SHOULD NOT</span> be used, since the external key
pair recalled below gives better security.<a href="#section-4.2-8.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-8.2">
            <p id="section-4.2-8.2.1">The external_priv, external_pub key pair used for external initialization. The
external_priv key is known to all group members in the current epoch. A member
stores external_priv only for the current epoch. Using this key pair gives
better security guarantees than using the key pair of the root of the ratchet
tree and should always be preferred.<a href="#section-4.2-8.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.2-8.3">
            <p id="section-4.2-8.3.1">The init_key in a KeyPackage and the corresponding secret key. The secret key
is known only to the owner of the KeyPackage and is deleted immediately after it
is used to join a group.<a href="#section-4.2-8.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="signature-keys">
<section id="section-4.3">
        <h3 id="name-signature-keys">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-signature-keys" class="section-name selfRef">Signature Keys</a>
        </h3>
<p id="section-4.3-1">MLS session states contain a number of signature keys including the ones in the
LeafNode structs. Application components can safely sign content and verify
signatures using these keys via the SafeSignWithLabel and SafeVerifyWithLabel
functions, respectively, much like how the basic MLS protocol uses SignWithLabel
and VerifyWithLabel.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">In more detail, a component identified by ComponentID should sign and verify
using:<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.3-3">
<pre>
SafeSignWithLabel(ComponentID, SignatureKey, Label, Content) =
    SignWithLabel(SignatureKey, "ComponentOperationLabel", ComponentOperationLabel)

SafeVerifyWithLabel(ComponentID, VerificationKey, Label, Content, SignatureValue) =
    VerifyWithLabel(VerificationKey, "ComponentOperationLabel", ComponentOperationLabel, SignatureValue)
</pre><a href="#section-4.3-3" class="pilcrow">¶</a>
</div>
<p id="section-4.3-4">Where the fields of ComponentOperationLabel are set to<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.3-5">
<pre>
label = Label
component_id = ComponentID
context = Content
</pre><a href="#section-4.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.3-6">For signing operations, the ComponentID <span class="bcp14">MUST</span> be set to the ComponentID of the
component performing the signature, and not to the ID of any other component.
This means that a component cannot produce signatures in place of other
component. However, components can verify signatures computed by other
components. Domain separation is ensured by explicitly including the ComponentID
with every operation.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pre-shared-keys">
<section id="section-4.4">
        <h3 id="name-pre-shared-keys">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-pre-shared-keys" class="section-name selfRef">Pre-Shared Keys</a>
        </h3>
<p id="section-4.4-1">PSKs represent key material that is injected into the MLS key schedule when
creating or processing a commit as defined in <span><a href="https://rfc-editor.org/rfc/rfc9420#section-8.4" class="relref">Section 8.4</a> of [<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>. Its
injection into the key schedule means that all group members have to agree on
the value of the PSK.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">While PSKs are typically cryptographic keys which due to their properties add to
the overall security of the group, the PSK mechanism can also be used to ensure
that all members of a group agree on arbitrary pieces of data represented as
octet strings (without the necessity of sending the data itself over the wire).
For example, a component can use the PSK mechanism to enforce that all group
members have access to and agree on a password or a shared file.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">This is achieved by creating a new epoch via a PSK proposal. Transitioning to
the new epoch requires using the information agreed upon.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">To facilitate using PSKs in a safe way, this document defines a new PSKType for
application components. This provides domain separation between pre-shared keys
used by the core MLS protocol and applications, and between those used by
different components.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.4-5">
<pre>
enum {
  // ...
  application(3),
  (255)
} PSKType;

struct {
  PSKType psktype;
  select (PreSharedKeyID.psktype) {
    // ...
    case application:
      ComponentID component_id;
      opaque psk_id&lt;V&gt;;
  };
  opaque psk_nonce&lt;V&gt;;
} PreSharedKeyID;
</pre><a href="#section-4.4-5" class="pilcrow">¶</a>
</div>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.4-6.1">
            <p id="section-4.4-6.1.1">TODO: It seems like you could also do this by structuring the <code>external</code>
PSKType as (component_id, psk_id).  I guess this approach separates this API
from other external PSKs.<a href="#section-4.4-6.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="exported-secrets">
<section id="section-4.5">
        <h3 id="name-exported-secrets">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-exported-secrets" class="section-name selfRef">Exported Secrets</a>
        </h3>
<p id="section-4.5-1">An application component can use MLS as a group key agreement protocol by
exporting symmetric keys.  Such keys can be exported (i.e. derived from MLS key
material) in two phases per epoch: Either at the start of the epoch, or during
the epoch. Derivation at the start of the epoch has the added advantage that the
source key material is deleted after use, allowing the derived key material to
be deleted later even during the same MLS epoch to achieve forward secrecy. The
following protocol secrets can be used to derive key from for use by application
components:<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-2.1">
            <p id="section-4.5-2.1.1"><code>exporter_secret</code> at the beginning of an epoch<a href="#section-4.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.5-2.2">
            <p id="section-4.5-2.2.1"><code>application_export_secret</code> during an epoch<a href="#section-4.5-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.5-3">The <code>application_export_secret</code> is an additional secret derived from the
<code>epoch_secret</code> at the beginning of the epoch in the same way as the other
secrets listed in Table 4 of <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> using the label "application_export".<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">Any derivation performed by an application component either from the
<code>exporter_secret</code> or the <code>application_export_secret</code> has to use the following
function:<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<div class="lang-tls sourcecode" id="section-4.5-5">
<pre>
DeriveApplicationSecret(Secret, Label) =
  ExpandWithLabel(Secret, "ApplicationExport " + ComponentID + " " + Label)
</pre><a href="#section-4.5-5" class="pilcrow">¶</a>
</div>
<p id="section-4.5-6">Where ExpandWithLabel is defined in <span><a href="https://rfc-editor.org/rfc/rfc9420#section-8" class="relref">Section 8</a> of [<a href="#RFC9420" class="cite xref">RFC9420</a>]</span> and where
ComponentID <span class="bcp14">MUST</span> be set to the ComponentID of the component performing the
export.<a href="#section-4.5-6" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.5-7.1">
            <p id="section-4.5-7.1.1">TODO: This section seems over-complicated to me.  Why is it not sufficient to
just use the <code>exporter_secret</code>?  Or the <code>MLS-Exporter</code> mechanism with a
label structured to include the ComponentID?<a href="#section-4.5-7.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="carrying-application-data-in-mls">
<section id="section-4.6">
        <h3 id="name-carrying-application-data-i">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-carrying-application-data-i" class="section-name selfRef">Carrying Application Data in MLS</a>
        </h3>
<p id="section-4.6-1">MLS provides a few extension points, including <code>extensions</code> fields on several
objects and extensible set of proposal types.  This section defines simple,
standard ways for applications to use these extension points.  The intent is to
allow MLS stacks to offer one set of APIs that can serve many application needs,
so that applications don't need to define and negotiate extensions at the MLS
level.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<div id="applicationdata-extension">
<section id="section-4.6.1">
          <h4 id="name-application_data-extension">
<a href="#section-4.6.1" class="section-number selfRef">4.6.1. </a><a href="#name-application_data-extension" class="section-name selfRef"><code>application_data</code> Extension</a>
          </h4>
<p id="section-4.6.1-1">The MLS GroupContext, LeafNode, KeyPackage, and GroupInfo objects each have an
<code>extensions</code> field that can carry additional data not defined by the MLS
specification.  The <code>application_data</code> extension provides a generic container
that applications can use to attach application data to these messages.  Each
usage of the extension serves a slightly different purpose:<a href="#section-4.6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.1-2.1">
              <p id="section-4.6.1-2.1.1">GroupContext: Confirms that all members of the group agree on the application
data, and automatically distributes it to new joiners.<a href="#section-4.6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.1-2.2">
              <p id="section-4.6.1-2.2.1">KeyPackage and LeafNode: Associates the application data to a particular
client, and advertises it to the other members of the group.<a href="#section-4.6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.6.1-2.3">
              <p id="section-4.6.1-2.3.1">GroupInfo: Distributes the application data confidentially to the new joiners
for whom the GroupInfo is encrypted (as a Welcome message).<a href="#section-4.6.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.6.1-3">The content of the <code>application_data</code> extension is a serialized
ApplicationDataDictionary object:<a href="#section-4.6.1-3" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.1-4">
<pre>
struct {
    ComponentID component_id;
    opaque data&lt;V&gt;;
} ComponentData;

struct {
    ComponentData component_data&lt;V&gt;;
} ApplicationDataDictionary;
</pre><a href="#section-4.6.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.6.1-5">The entries in the <code>component_data</code> <span class="bcp14">MUST</span> be sorted by <code>component_id</code>, and there
<span class="bcp14">MUST</span> be at most one entry for each <code>component_id</code>.<a href="#section-4.6.1-5" class="pilcrow">¶</a></p>
<p id="section-4.6.1-6">An <code>application_data</code> extension in a LeafNode, KeyPackage, or GroupInfo can be
set when the object is created.  An <code>application_data</code> extension in the
GroupContext needs to be manage using the tools available to update GroupContext
extensions: The creator of the group can set extensions unilaterally, and
thereafter, the GroupContextExtensions proposal can be used to update
extensions.  The ApplicationDataUpdate proposal described in
<a href="#applicationdataupdate" class="auto internal xref">Section 4.6.3</a> provides a more efficient way to update the
<code>application_data</code> extension.<a href="#section-4.6.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="applicationdata">
<section id="section-4.6.2">
          <h4 id="name-applicationdata">
<a href="#section-4.6.2" class="section-number selfRef">4.6.2. </a><a href="#name-applicationdata" class="section-name selfRef">ApplicationData</a>
          </h4>
<p id="section-4.6.2-1">The ApplicationData proposal type allows an application component to associate
application data to a Commit, so that the member processing the Commit knows
that all other group members will be processing the same data.  ApplicationData
proposals are ephemeral in the sense that they do not change any persistent
state related to MLS, aside from their appearance in the transcript hash.<a href="#section-4.6.2-1" class="pilcrow">¶</a></p>
<p id="section-4.6.2-2">The content of an ApplicationData proposal is the same as an <code>application_data</code>
extension.  The proposal type is set in <a href="#iana-considerations" class="auto internal xref">Section 6</a>.<a href="#section-4.6.2-2" class="pilcrow">¶</a></p>
<div class="lang-tls-presentation sourcecode" id="section-4.6.2-3">
<pre>
struct {
    ComponentID component_id;
    opaque data&lt;V&gt;;
} ApplicationData;
</pre><a href="#section-4.6.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6.2-4">An ApplicationData proposal is invalid if it contains a <code>component_id</code> that is
unknown to the application, or if the <code>application_data</code> field contains any
<code>ComponentData</code> entry whose <code>data</code> field is considered invalid by the
application logic registered to the indicated <code>component_id</code>.<a href="#section-4.6.2-4" class="pilcrow">¶</a></p>
<p id="section-4.6.2-5">ApplicationData proposals <span class="bcp14">MUST</span> be processed after any default proposals (i.e.,
those defined in <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>), but before any ApplicationDataUpdate proposals.<a href="#section-4.6.2-5" class="pilcrow">¶</a></p>
<p id="section-4.6.2-6">A client applies an ApplicationData proposal by providing the contents of the
<code>application_data</code> field to the component identified by the <code>component_id</code>.  If
a Commit references more than one ApplicationData proposal for the same
<code>component_id</code> value, then they <span class="bcp14">MUST</span> be processed in the order in which they are
specified in the Commit.<a href="#section-4.6.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="applicationdataupdate">
<section id="section-4.6.3">
          <h4 id="name-applicationdataupdate">
<a href="#section-4.6.3" class="section-number selfRef">4.6.3. </a><a href="#name-applicationdataupdate" class="section-name selfRef">ApplicationDataUpdate</a>
          </h4>
<p id="section-4.6.3-1">Updating the <code>application_data</code> with a GroupContextExtensions proposal is
cumbersome.  The application data needs to be transmitted in its entirety, along
with any other extensions, whether or not they are being changed.  And a
GroupContextExtensions proposal always requires an UpdatePath, which updating
application state never should.<a href="#section-4.6.3-1" class="pilcrow">¶</a></p>
<p id="section-4.6.3-2">The ApplicationDataUpdate proposal allows the <code>application_data</code> extension to
be updated without these costs.  Instead of sending the whole value of the
extension, it sends only an update, which is interpreted by the application to
provide the new content for the <code>application_data</code> extension.  No other
extensions are sent or updated, and no UpdatePath is required.<a href="#section-4.6.3-2" class="pilcrow">¶</a></p>
<p id="section-4.6.3-3">```
enum {
    invalid(0),
    update(1),
    remove(2),
    (255)
} ApplicationDataUpdateOperation;<a href="#section-4.6.3-3" class="pilcrow">¶</a></p>
<p id="section-4.6.3-4">struct {
    ComponentID component_id;
    ApplicationDataUpdateOperation op;<a href="#section-4.6.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6.3-5">
<pre>
select (ApplicationDataUpdate.op) {
    case update: opaque update&lt;V&gt;;
    case remove: struct{}
} } ApplicationDataUpdate; ```
</pre><a href="#section-4.6.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.6.3-6">An ApplicationDataUpdate proposal is invalid if its <code>component_id</code> references a
component that is not known to the application, or if it specifies the removal
of state for a <code>component_id</code> that has no state present.  A proposal list is
invalid if it includes multiple ApplicationDataUpdate proposals that <code>remove</code>
state for the same <code>component_id</code>, or proposals that both <code>update</code> and <code>remove</code>
state for the same <code>component_id</code>.  In other words, for a given <code>component_id</code>,
a proposal list is valid only if it contains (a) a single <code>remove</code> operation or
(b) one or more <code>update</code> operation.<a href="#section-4.6.3-6" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.6.3-7.1">
              <p id="section-4.6.3-7.1.1">TODO: Deconflict with GroupContextExtensions.<a href="#section-4.6.3-7.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.6.3-8">ApplicationDataUpdate proposals are processed after any default proposals (i.e., those
defined in <span>[<a href="#RFC9420" class="cite xref">RFC9420</a>]</span>), and any ApplicationData proposals.<a href="#section-4.6.3-8" class="pilcrow">¶</a></p>
<p id="section-4.6.3-9">A client applies ApplicationDataUpdate proposals by component ID.  For each
<code>component_id</code> field that appears in an ApplicationDataUpdate proposal in the
Commit, the client assembles a list of ApplicationDataUpdate proposals with that
<code>component_id</code>, in the order in which they appear in the Commit, and processes
them in the following way:<a href="#section-4.6.3-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.3-10.1">
              <p id="section-4.6.3-10.1.1">If the list comprises a single proposal with the <code>op</code> field set to <code>remove</code>:<a href="#section-4.6.3-10.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.3-10.1.2.1">
                  <p id="section-4.6.3-10.1.2.1.1">If there is an entry in the <code>component_states</code> vector in the
<code>application_state</code> extension with the specified <code>component_id</code>, remove
it.<a href="#section-4.6.3-10.1.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.1.2.2">
                  <p id="section-4.6.3-10.1.2.2.1">Otherwise, the proposal is invalid.<a href="#section-4.6.3-10.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.6.3-10.2">
              <p id="section-4.6.3-10.2.1">If the list comprises one or more proposals, all with <code>op</code> field set to
<code>update</code>:<a href="#section-4.6.3-10.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.6.3-10.2.2.1">
                  <p id="section-4.6.3-10.2.2.1.1">Provide the application logic registered to the <code>component_id</code> value with
the content of the <code>update</code> field from each proposal, in the order
specified.<a href="#section-4.6.3-10.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.2.2.2">
                  <p id="section-4.6.3-10.2.2.2.1">The application logic returns either an opaque value <code>new_data</code> that will be
stored as the new application data for this component, or else an
indication that it considers this update invalid.<a href="#section-4.6.3-10.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.2.2.3">
                  <p id="section-4.6.3-10.2.2.3.1">If the application logic considers the update invalid, the MLS client <span class="bcp14">MUST</span>
consider the proposal list invalid.<a href="#section-4.6.3-10.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.2.2.4">
                  <p id="section-4.6.3-10.2.2.4.1">If no <code>application_data</code> extension is present in the GroupContext, add one
to the end of the <code>extensions</code> list in the GroupContext.<a href="#section-4.6.3-10.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.2.2.5">
                  <p id="section-4.6.3-10.2.2.5.1">If there is an entry in the <code>component_data</code> vector in the
<code>application_data</code> extension with the specified <code>component_id</code>, then set
its <code>data</code> field to the specified <code>new_data</code>.<a href="#section-4.6.3-10.2.2.5.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-4.6.3-10.2.2.6">
                  <p id="section-4.6.3-10.2.2.6.1">Otherwise, insert a new entry in the <code>component_states</code> vector with the
specified <code>component_id</code> and the <code>data</code> field set to the <code>new_data</code>
value.  The new entry is inserted at the proper point to keep the
<code>component_states</code> vector sorted by <code>component_id</code>.<a href="#section-4.6.3-10.2.2.6.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.6.3-10.3">
              <p id="section-4.6.3-10.3.1">Otherwise, the proposal list is invalid.<a href="#section-4.6.3-10.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.6.3-11.1">
              <p id="section-4.6.3-11.1.1">TODO: An alternative design here would be to have the <code>update</code> operation
simply set the new value for the <code>application_data</code> GCE, instead of sending a
diff.  This would be simpler in that the MLS stack wouldn't have to ask the
application for the new state value, and would discourage applications from
storing large state in the GroupContext directly (which bloats Welcome
messages).  It would effectively require the state in the GroupContext to be a
hash of the real state.  This pushes some complexity onto the application,
since the application has to define a hashing algorithm, and could make
debugging more complex.<a href="#section-4.6.3-11.1.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">The API defined in this document provides the following security guarantee: If
an application uses MLS and all its components use this API, then the security
guarantees of the base MLS protocol and the security guarantees of the
components, each analyzed in isolation, still hold for the composed protocol. In
other words, the API protects applications from careless
component developers. As long as all the components use this API, it is not
possible that some combination of components  (the developers of which did not know
about each other) impedes the security of the base MLS protocol or any used
component. No further analysis of the combination is necessary. This also means
that any security vulnerabilities introduced by one component do not spread to
other component or the base MLS protocol.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">TODO:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">
          <p id="section-6-2.1.1">Register <code>application_data</code> extension<a href="#section-6-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.2">
          <p id="section-6-2.2.1">Register ApplicationData proposal<a href="#section-6-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-6-2.3">
          <p id="section-6-2.3.1">Register ApplicationDataUpdate proposal<a href="#section-6-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-combined-references">
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9180">[RFC9180]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9420">[RFC9420]</dt>
      <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Robert, R.</span>, <span class="refAuthor">Millican, J.</span>, <span class="refAuthor">Omara, E.</span>, and <span class="refAuthor">K. Cohn-Gordon</span>, <span class="refTitle">"The Messaging Layer Security (MLS) Protocol"</span>, <span class="seriesInfo">RFC 9420</span>, <span class="seriesInfo">DOI 10.17487/RFC9420</span>, <time datetime="2023-07" class="refDate">July 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9420">https://www.rfc-editor.org/rfc/rfc9420</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.mls-architecture">[I-D.mls-architecture]</dt>
      <dd>
<span class="refTitle">"*** BROKEN REFERENCE ***"</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="appendix-A-1.1">
          <p id="appendix-A-1.1.1"><strong>TODO:</strong> Acknowledgements.<a href="#appendix-A-1.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Joel Alwen</span></div>
<div dir="auto" class="left"><span class="org">Amazon</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:alwenjo@amazon.com" class="email">alwenjo@amazon.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Richard Barnes</span></div>
<div dir="auto" class="left"><span class="org">Cisco</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rlb@ipv.sx" class="email">rlb@ipv.sx</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rohan Mahy</span></div>
<div dir="auto" class="left"><span class="org">Rohan Mahy Consulting Services</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rohan.ietf@gmail.com" class="email">rohan.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Marta Mularczyk</span></div>
<div dir="auto" class="left"><span class="org">Amazon</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mulmarta@amazon.com" class="email">mulmarta@amazon.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
